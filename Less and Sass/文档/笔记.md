# Less学习笔记

[TOC]

# 一. 快速开始

> 用法

Less是CSS预处理器，在CSS基础上新增了变量、混合器、函数等功能。使CSS更易维护、主题化更强、更易扩展。

本地环境中Less使用Node.js解析，浏览器中使用Rhino解析，也可使用第三方插件（如 **less-watch-compile**）实时编译查看。尝鲜可使用[在线编辑器](http://lesscss.org/less-preview/)。

如下Less文件：

```less
@base: #f938ab;

.box-shadow(@style, @c) when (iscolor(@c)) {
  -webkit-box-shadow: @style @c;
  box-shadow:         @style @c;
}
.box-shadow(@style, @alpha: 50%) when (isnumber(@alpha)) { 
  .box-shadow(@style, rgba(0, 0, 0, @alpha));
}
.box {
  color: saturate(@base, 5%);
  border-color: lighten(@base, 30%);
  div { .box-shadow(0 0 5px, 30%) }
}
```

编译为：

```css
.box {
  color: #fe33ac;
  border-color: #fdcdea;
}
.box div {
  -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}
```

## 如何使用

### 安装

```bash
npm install -g less
```

### 命令行工具

```bash
lessc style.less
```

上述命令将编译的CSS结果显示在标准输出流中（stdout）。

编译到指定文件：

```bash
lessc style.less style.css
```

如需编译结果为压缩形式，需安装 [clean-css插件](https://github.com/less/less-plugin-clean-css)：

```bash
lessc --clean-css style.less style.min.css
```

### 在代码中使用

```js
var less = require('less');
less.render('.class {width: (1 + 1) }', function (e, output) {
	console.log(output.css);
});
```

将输出：

```css
.class{
	width: 2;
}
```

### 配置

```js
var less = require('less');
less.render('.class {width: (1+1)}',
	{
		paths: ['.', './lib'], //指定@import查找的文件位置
		filename: 'style.less', //指定文件，使报错信息友好
		compress: true //编译结果是否为压缩形式
	},
	function (e, output) {
		console.log(output.css);
	}
);
```

## 客户端

_在客户端使用Less仅为开发提供便利，不建议在生产环境使用_

```html
<link rel="stylesheet/less" href="styles.less" type="text/css">
```

```html
<script src="less.js" type="text/javascript"></script>
```

注意：

-   Less文件需要在脚本文件**前**引用
-   引用多个.less文件时，它们独立编译，不能互相访问变量和混合器等。
-   受“同源策略”限制，需配置[跨域请求](http://enable-cors.org/)

### 浏览器中配置编译选项

在`<script src="less.js"></script>`引用前声明全局的Less对象：

```html
<script>
  less = {
    env: "development",
    async: false,
    fileAsync: false,
    poll: 1000,
    functions: {},
    dumpLineNumbers: "comments",
    relativeUrls: false,
    rootpath: ":/a.com/"
  };
</script>
<script src="less.js"></script>
```

或者为script标签设置`data`属性（需浏览器支持`JSON.parse`方法）

```html
<script src="less.js" data-poll="1000" data-relative-urls="false"></script>
<link data-dump-line-numbers="all" data-global-vars='{ myvar: "#ddffee", mystr: "\"quoted\"" }' rel="stylesheet/less" type="text/css" href="less/styles.less">
```

## 获取Less

### [官网下载](https://raw.github.com/less/less.js/v2.7.1/dist/less.min.js)

### [下载源码](https://github.com/less/less.js/archive/v2.7.1.zip)

### [在GitHub上克隆或Fork](https://github.com/less/less.js.git)

### 使用[Bower](http://bower.io/)下载

```base
bower install less
```



# 二. V2新特性

## 语言更新

编译后的颜色保持原样，比如`yellow`的编译结果就是`yellow`。

## 压缩编译结果

`clean-css`已独立为插件，使用npm单独安装：

```bash
npm install -g less-plugin-clean-css
```

命令行用法变动不大：

```bash
# 旧
lessc --clean-css --clean-option=--compatibility:ie8 --clean-option=--advanced
# 新？
lessc --clean-css="--compatibility=ie8 --advanced"

# 或者
lessc --clean-css test.less
```

## Sourcemaps(？)

优化sourcemap配置选项和生成文件路径，无需任何配置即在正确路径生成sourcemap文件。

## 代码中使用

弃用`less.Parser`和`less.toCss`，以`less.render`代之。

此新方法不只将CSS结果作为字符串返回，而是返回兼有`css`和`map`（如果声明）属性的对象。

sourcemap选项又原来的`options.sourceMapFullFilename =`形式，更改为新形式：`options.sourceMap = { sourceMapFullFilename:`。？

## 浏览器用法？

# 三. 命令行用法

## 全局安装

```bash
npm install less -g
```

此方法安装后，全局环境可用。如需安装指定版本，添加后缀`@VERSION`，比如：

```bash
npm install less@1.6.2 -g
```

## Node开发环境安装

指定项目单独安装：

```bash
npm install less --save-dev
```

此命令将安装官方最新版本，且在`package.json`文件中添加到`deveDependencies`属性中。

`package.json`文件中会指定版本范围，npm用于补丁安装。

### 安装beta版本

### 安装未发布的开发版本

## 服务器端？

资源库包含二进制文件，`bin/lessc`可在安装有Node.js的\*nix、OS X和Windows平台上运行：

```bash
lessc [option option=parameter ...] <source> [destination]
```

## 命令行用法

```bash
lessc [option option=parameter ...] <source> [destination]
```

如果源文件设置`\-`命令选项，从标准输入文件读取数据。?

例：

```bash
# 将bootstrap.less文件编译h为bootstrap.css文件
lessc bootstrap.less bootstrap.css

# 将bootstrap.less文件编译h为bootstrap.css文件，并且压缩编译结果
lessc -x bootstrap.less bootstrap.css
```

### 配置选项

#### 帮助

```bash
lessc --help
lessc -g
```

标准流中输出帮助文档。

#### Include Paths

```bash
lessc --include-path=PATH1;PATH2
```

设置文件引用路径。在Windows中路径名可使用`;`或`:`隔开。

使用`@import`声明时，如果不存在指定路径，Less将使用此配置中指定的路径。

在Node环境中设置路径：

```js
{path: ['PATH1', 'PATH2']}
```

#### Makefile

```bash
lessc -M
lessc --depends
```

#### No Color

```bash
lessc --no-color
```

#### No IE Compatibility

```bash
lessc --no-ie-compat
```

目前仅用于`data-uri`函数，创建能适应浏览器处理的图片大小。？

#### 禁用JavaScript

```bash
lessc --no-js
```

#### 校验（Lint）

```bash
lessc --lint
lessc -l
```

仅输出校验结果。

#### Slient

```bash
lessc -s
lessc --silient
```

不输出错误消息。

#### Strict Imports

```bash
lessc --strict-imports
```

#### 允许导入不安全的HTTPS Hosts

```bash
lessc --insecure
```

#### 版本号

```less
lessc -v
lessc --version
```

#### 压缩

```bash
lessc -x
lessc --compress
```

使用Less内置压缩工具，但不具备所有CSS压缩功能。

#### Clean CSS

自Less版本2开始，已独立为插件。

#### Sourcemap输出文件

```bash
lessc --source-map
lessc --source-map=file.map
```

如果未指定输出文件，使用Less源文件名+`.map`后缀。

#### Sourcemap文件根路径（Rootpath）?

```bash
lessc --source-map-rootpath=dev-files/
```

指定在sourcemap文件中，为所有Less文件添加的根路径，以及在输出CSS文件中指定的.map文件。？

由于基础路径（basepath）默认为less文件所处的文件夹，所以根路径默认为sourcemap文件到基础路径之间的文件路径。

比如，CSS文件在服务器的根目录中生成，而需用其他文件夹中的less/css/map源文件：

```bash
output.css
dev-files/output.map
dev-files/main.less
```

#### Sourcemap文件基础路径（Basepath）?

```bash
lessc --source-map-basepath=less-files/
```

默认为less源文件所处文件夹

与根路径相反，指定在输出文件路径中去除的路径。比如，如果需要编译的文件在Less文件所处的文件夹内，但源文件在服务器的根路径或当前路径，就可指定去除此文件。？？

#### Source Map Less Inline?

```bash
lessc --source-map-less-inline
```

指定将所有Less文件包含到sourcemap中。如与souce-map-map-inline选项结合使用，可不需添加任何外部文件。？

#### Source Map Map Inline?

```bash
lessc --source-map-map-inline
```

指定map文件内嵌到输出的CSS文件中。生产环境中不推荐。但在开发环境中可使浏览器使用编译后的文件，却可查看源Less文件。

#### Source Map URL?

```bash
lessc --source-map-url=../my-map.json
```

重置CSS文件中指向map文件的路径。在根路径和基础路径没有生成所需路径时使用。

#### Rootpath

```bash
lessc -rp=resources/
lessc --rootpath=resources/
```

为CSS文件中import声明和url添加路径。不影响less文件中的引用声明，只在输出的CSS文件中起作用。

比如，如果CSS文件中使用的所有图片都在文件夹`resources`中，就可在less文件中简写文件路径，而使用此声明添加路径。

#### 相对路径（Relative URLs）

```bash
lessc -ru
lessc --relative-urls
```

默认情况下，生成CSS文件中的URL保持不变。如果导入一个引入了图片的子目录文件时，输出CSS文件中路径也会保持相对一致。此选项允许重置URL，将导入的文件的路径作为图片路径的相对路径，这样就确保URL总是相对于基于导入的文件。如：

```less
# main.less
@import "files/backgrounds.less";
# files/backgrounds.less
.icon-1 {
  background-image: url('images/lamp-post.png');
}
```

正常情况下编译为：

```css
.icon-1 {
  background-image: url('images/lamp-post.png');
}
```

如果使用此选项，编译结果为：

```css
.icon-1 {
  background-image: url('files/images/lamp-post.png');
}
```

使用`data-uri`函数也可达到同样效果。

#### Strict Math

```bash
lessc -sm=on
lessc --strict-math=on
```

默认关闭（--strict-math=off）。

关闭时，Less默认计算所有必要的运算：

```less
.class {
	width    : calc(100% - (10px - 5px));
	height   : (100px / 4px);
	font-size: 1 / 4;
}
```

编译为：

```css
.class {
	width    : calc(95%);
	height   : 25px;
	font-size: 0.25;
}
```

如果开启（on）,只时通过计算去除不必要的括号，编译为：

```css
.class {
	width    : calc(100% - (10px - 5px));
	height   : 25px;
	font-size: 1 / 4;
}
```

#### Strict Unit

```bash
lessc -su=on
lessc --strict-unit=on
```

默认关闭（--strict-unit=off）。

如：

```less
.class{
	property: 1px * 2px;
}
```

关闭时，Less将此计算当做一个值带单位，而另一个值不带单位，不报错。而开启时（--strict-unit=on），此计算为两个带单位的值相乘得面积，而Less并不支持面积计算，因此报错。

#### 全局变量声明

```bash
lessc -gobal-var="my-background=black"
```

相当于在文件顶部中声明全局变量，可重置。

#### 全局变量修改

```bash
lessc --modify-var="my-background=white"
```

与全局变量声明相反。相当于在文件末尾声明全局变量，可重置所有已声明变量。

#### URL参数

```bash
lessc --url="cache121221"
```

为每个URL添加参数。可用来破坏浏览器缓存。

#### 行号

```bash
lessc --line-numbers=comments
lessc --line-numbers=mediaquery
lessc --line-numbers=all
```

浏览器支持sourcemap前的做法。 **已废除**

#### 插件

```bash
lessc --clean-css="advanced"
lessc --plugin=clean-css="advanced"
```

如果插件名以`less-plugin-`开头可省略`--plugin=`。比如clean css插件名为`less-plugin-clean-css`，就可直接使用`--clean-css`。插件配置声明写法一样。



# 四. 浏览器中使用

生产环境中，不建议在浏览器中直接使用Less。开发环境中，需要动态编译Less文件时可在浏览器中直接使用。不过更好的解决方法是使用有监听和热加载功能的工具（比如grunt和gulp）。原因在于`less.js`文件体积大，编译耗时，造成页面停滞。而且，移动端浏览器编译速度更慢。

在页面中加载Less脚本：

```html
<!-- 此处： 添加Less插件文件，浏览器shims，或者声明Less配置选项。-->
<script src="less.js"> </script>
```

此脚本可侦测到页面中所有Less文件：

```html
<link rel="stylesheet" href="style.less" type="stylesheet/less">
```

## 配置

有3种配置方式：

### 1 代码模式：

```html
<script>
	less = {
		env: "development"
	};
</script>
<script src="less.js"></script>
```

### 2 在script标签中配置

```html
<script src="less.js" data-env="development"></script>
```

### 3 在link标签中配置

在单个link标签中配置，不仅可以实现独立控制，还可实现配置重置。（一些配置不能重置）

```html
<link data-dump-line-numbers="all" data-global-vars='{"myvar": "#ddffee", "mystr"="\"qouted\""}' rel="stylesheet/less" href="less/style.less">
```

### 注意点：

-   权重等级：window.less > script tag > link tag
-   data属性名不是驼峰形式（logLevel -> data-log-leve）
-   link标签中配置时仅支持渲染配置（`verbose`和`logLevel`等选项不支持）
-   非字符串属性值为JSON形式（使用双引号而非单引号：`data-global-vars='{"myvar": "#ddffee", "mystr"="\"qouted\""}'`）

## 监听模式

`env`属性需设置为`development`，且在`less.js`文件**后**调用`less.watch()`方法。

```html
<script>less = {env: 'development'}</script>
<script src="less.js"></script>
<script>less.watch();</script>
```

浏览器网址后添加`#！watch`实现监听模式？：

```text
index.html#!watch
```

## 变量修改

动态修改变量。声明新变量后，Less文件重新编译，但页面不会重新加载：

```js
less.modifyVars({
	'@buttonFace': '#5B83AD',
	'@buttonText': '#D9EEF2'
});
```

## 调试?

配置`dumpLineNumbers`或在link标签的URL属性后添加`!dumpLineNumbers:mediaquery`。

配置`mediaquery`属性，使用FireLESS。配置`comment`属性可显示文件信息，以及编译后的内嵌CSS代码行号。

## 配置选项

在加载less.js文件**前**声明全局`less`变量：

```html
<!-- 在less.js前声明 -->
<script>
  less = {
    env: "development",
    logLevel: 2,
    async: false,
    fileAsync: false,
    poll: 1000,
    functions: {},
    dumpLineNumbers: "comments",
    relativeUrls: false,
    globalVars: {
      var1: '"string value"',
      var2: 'regular value'
    },
    rootpath: ":/a.com/"
  };
</script>
<script src="less.js"></script>
```

### async

类型： `Boolean`

默认值：`false`

是否异步请求引用文件。

### dumpLineNumbers

类型： `string`：`‘’` \| `comments` \| `mediaquery`。

默认值：`‘’`

设置后在编译后的CSS文件中显示源代码行号。

`comments`用于显示可读信息；`mediaquery`用于结合Firefox的调试工具。

_将来可能被sourcemap代替。_

### evn

类型： `string`

默认值：取决于页面URL

可以是`development`或`production`。

使用`productuion`时，编译后的CSS储存在Local Storage中，控制台不输出消息。

如果文档URL以`file://`开头，或本机测试，或不标准端口，都默认设置为`development`。

例：

```js
less = {env: 'production'};
```

### errorReporting

类型： `String`

可选： `html` \| `console` \| `function`

默认值：html

编译失败后的报错方式。

### fileAsync

类型： `Boolean`

默认值：`false`

使用文件协议时，是否同步导入引用文件？。

### function

类型： `object`

`key`为函数名，可等同于Less函数使用：

```js
less = {
	functions: {
		myfunc : function(){
			return new(less.tree.Dimension)(1);
		}
	}
}
```

```less
.my-class{
	border-width: unit(myfun(), px);
}
```

### logLevel

类型： `Number`

默认值：2

控制台错误报告级别。`production`环境中不输出。

```text
2 - Information and errors
1 - Errors
0 - Nothing
```

### poll

类型： `Integer`

默认值：10000

监听模式下轮询间隔（毫秒mm）。

### relativeUrls

类型： `Boolean`

默认值：`false`

是否调整相对路径。为`false`时，已相对于入口Less文件。

### globalVars

类型： `Object`

默认值：`undefined`

相当于在Less文件顶部声明变量，可重载：

```js
less.globalVars = {myvar: "#ddffee", mystr="\"quoted\""}
```

### modifyVars

类型： `Object`

默认值：`undefined`

类似于`globalVars`，不过相当于在Less文件底部声明变量，可重载所有已声明变量。

### rootPAth

类型： `String`

默认值：`false`

在所有URL前添加的的路径。

### useFileCache

类型： `Boolean`

默认值：`true`（在V2前默认为`false`）

是否使用文件缓存。缓存Less文件后，当使用`modifyVars`后不会重新加载所有Less文件。如果使用监听模式，或者重新加载，刷新前所有缓存都会被清除。？

## 浏览器支持

估计一般不会在浏览器中用，这节不翻了。



# 五. 插件

## 命令行

推荐安装以“less-plugin-”开头的插件。

```bash
npm install less-plugin-clean-css -g
```

使用：

```bash
less --clean-css="advanced"
```

## 代码中使用插件

所有插件都放置在Array中：

```js
var myPlugin = require("my-plugin");

less.render(myCSS, {plugins: [myPlugin]})
	.then(function(output){}, function(error){});
```

## 浏览器中使用插件

在less.js**前**加载插件文件，并声明插件使用：

```html
<script src="plugin.js"></script>
<script>
less = {
    plugins: [plugin]
};
</script>  
<script src="less.min.js"></script>
```

## 常用插件列表

更多插件，请查看[NPM Registry](https://www.npmjs.com/search?q=%22less-plugin%22)。

### 后处理（postprocessor）类

| 插件名                  | 作用                                  |
| :---------------------- | :------------------------------------ |
| Autoprefixer            | 添加厂商后缀                          |
| CSScomb                 | 美化/格式化                           |
| clean-css               | 压缩                                  |
| CSSWring                | 压缩                                  |
| css-flip                | 生成left-to-right或right-to-leftCSS？ |
| fuctions                | 编写定制函数                          |
| glob                    | 文件引用时支持Glob文件形式            |
| group-css-media-queries | 合并CSS 媒体查询声明                  |
| inline-urls             | 将`url()`转换为`data-url()`           |
| lesshint                | 校验                                  |
| npm-import              | 引用npm包                             |
| pleeease                | 使用pleeease后处理                    |
| rtl                     | ltr -> rtl                            |

### 框架类

| 插件名                   | 作用                      |
| :----------------------- | :------------------------ |
| Bootstrap                | 引用Bootstrap             |
| Bower Resovle            | 从Bower引用               |
| Cardinal CSS for less.js | 引用Cardinal              |
| Flexbox Grid             | 引用Flexbox Grid          |
| Flexible Grid System     | 引用 Flexible Grid System |
| Ionic                    | 引用Ionic                 |
| LessHat                  | 引用LessHat               |
| Skeleton                 | 引用Skeleton              |

### 函数类

| 插件名                   | 作用                                   |
| :----------------------- | :------------------------------------- |
| advanced-color-functions | 高级颜色处理函数                       |
| cubehelix                | `cubehelix(y,a,b,t)`返回a和b之间的颜色 |
| lists                    | 链表/数组处理函数库                    |

## 致插件作者

还不够当作者！

# 六. 概述

> 特性

作为CSS的扩展，Less不仅向后兼容CSS，还新增了很多功能语法。

## 变量

```less
@nice-blue: #5b83ad;
@light-blue: @nice-blue + #111;
#header{
    color: @light-blue;
}
```

输出：

```css
#header{
    color: #6c94be;
}
```

~~变量实质上为常量（constants），仅可单次声明。~~~~~~

## 混合器（mixin）

将已声明的规则利用到另外一个声明中，可使用混合器。比如已声明如下规则：

```less
.bordered{
    border-top: dotted 1px black;
    border-bottom: solid 2px black;
}
```

如果需要在其他声明中使用，只需将类名写入即可：

```less
#menu a{
    color: #111;
    .borderd;
}
.post a{
    color: red;
    .borderd;
}
```

_ID名也可作为混合器_

## 规则嵌套

Less可模仿HTML结构，支持规则嵌套。如下CSS：

```css
#head{
    color: black;
}
#head .navigation{
    font-size: 12px;
}
#head .logo{
    width: 200px;
}
```

在Less中可改写为：

```less
#head{
    color: black;
    .navigation{
        font-size: 12px;
    }
    .logo{
        width: 300px;
    }
}
```

嵌套规则还支持"父元素选择器"，如经典的clearfix：

```less
.clearfix{
    display: block;
    zoom: 1;

    &:after{
        content: " ";
        display: block;
        font-size: 0;
        height: 0;
        clear: both;
        visibility: hidden;
    }
}
```

## 探测器嵌套和冒泡

如`media`和`keyframe`这样的探测器可同选择器一样嵌套。不过，具有冒泡行为。

如`@media`、`@supports`和`@document`这样的条件探测器，编译的CSS中，探测器会向上"拉"到选择器为止：

```less
.screen-color{
    @media screen{
        color: green;
        @media (min-width: 768px){
            color: red;
        }
    }
    @media tv{
        color: black;
    }
}
```

编译结果为：

```css
@media screen {
    .screen-color{
        color: green;
    }
}
@media screen and (min-width: 768px) {
    .screen-color{
        color: red;
    }
}

@media tv {
    .screen-color{
        color: black;
    }
}
```

如`font-face`和`keyframes`这样的非条件探测器，仅会冒泡：

```less
#a {
    color: blue;
    @font-face{
        src: made-up-url;
    }
    padding: 2 2 2 2；
}
```

编译结果为：

```css
#a {
    color: blue;
    padding: 2 2 2 2;
}
@font-face {
    src: made-up-url;
}
```

## 运算符

数学运算符`+`、`-`、`*`、`/`可使用在任何数字、颜色和变量上。Less尽可能将单位考虑进去，在加减乘除前对各值转换。计算结果为**最左边**带单位值的单位。如果不能转换，则忽略单位，如`px`转`cm`：

```less
// 将数值转换为统一单位
@conversion-1: 5cm + 10mm; // 结果为6cm
@conversion-2: 2 - 3cm - 5mm; //结果为-1.5cm

// 不可转换的情况
@incompatible-units: 2 + 5px - 3cm; //结果为4px（本地测试为-107.38582677px;）

// 变量计算
@base: 5%;
@filler: @base * 2; //结果为10%
@other: @base + @filler; //结果为15%
```

乘法和除法不转换，结果单位以第一个数值单位为准。第二个或后面数值若有单位，则忽略：

```less
@base: 2cm * 3mm; //结果为6cm
```

颜色计算分为4个区间：red、green、blue和alpha，各区间单独计算。比如，如果两个颜色相加，结果的green区间为两个颜色的green区间之和；如果和数值相乘，则每个区间都与这个数值相乘。

注意：对alpha区间的计算并没有标准定义，虽然某些环境可用，但标准可能会改变，所以尽量避免使用。

如果前三个颜色区间的计算结果大于`ff`或小于`00`，则舍入为`ff`或`00`；如果alpha区间计算结果大于`1.0`或小于`0.0`，也舍入为`1.0`或`0.0`：

```less
@color: #2224488 / 2; //结果为#112244
background-color: #112244 + #111; //结果为#223355
```

## 转义

除**插值**外，所有在`~"anything"`或`~'anything'`内的字符串都不需转义。所写即所得。

```less
.wired-element{
    content: ~"^//* some horrible but needed css hack";
}
```

编译结果为：

```css
.wired-element{
    content: some horrible but needed css hack;
}
```

## 内置函数

Less提供了如色彩渐变，字符串操作和数学计算的函数。如下列代码：使用`percentage`函数将0.5转换为50%；使用`saturate`函数将颜色饱和度增大5%；使用`lighten`函数将颜色变淡25%，再使用`spin`函数颜色旋转8°（spin函数为旋转颜色的色相角度，取值范围为0-360）。

```less
@base: #f04615;
@width: 0.5;
.class {
    width           : percentage(@width);
    color           : saturate(@base, 5%);
    background-color: spin(lighten(@base, 25%), 8);
}
```

## 命名空间

（不要与CSS的`@namespace`和[命名空间选择器](http://www.w3.org/TR/css3-selectors/#typenmsp)混淆）

某些情况下，需要将所有复用的混合器写在一起。而使用时只需其中一部分。比如：

```less
#bundle{
    .button{
        display: block;
        border: 1px solid black;
        background-color: gre;
        &:hover{
            background-color: white;
        }
    }
    .tab{/**/}
    .citation{/**/}
}
```

只需使用`.button`的样式：

```less
#head a{
    color: orange;
    #bundle > .button;
}
```

**注意：** 命名空间内部定义的变量，其作用域仅限于其内部，且不能在外部引用。即只可引用命名空间的混合器（#namespace > 混合器），而不能引用命名空间变量（#namespace > 变量）。

## 作用域

Less内部变量查找模式与编程语言相仿：首先查找当前作用域，如果无，向上一级作用域查找：

```less
@var: red;
#page {
    @var: white;
    #head {
        color: @var; // white
    }
}
```

与js不同，变量不必在使用前声明，上例等价于：

```less
@var: red;
#page {
    #header {
        color: @var; //white
    }
    @var: white
}
```

## 注释

与CSS注释一样，支持当行和多行：

```less
/*这是
多行注释*/
@var: red;
//这是单行注释
@var: white;
```

## 文件引用

当某文件被引用后，其中的所有变量皆可用。文件后缀可省：

```less
@import "library";
@import "typo.css";
```

# 七. 变量

如果多次使用同一值，可将其抽离为变量，更易维护：

```less
a,
.link{
	color: black;
}
.widget{
	color: black;
	background: white;
}
```

可改写：

```less
// 变量声明
@link-color: black;
@link-color-hover: darken(@link-color, 10%);

//变量使用
a,
.link{
	color: @link-color;
}
a:hover{
	color: @link-color-hover
}
.widget{
	color: #fff;
	background: @link-color;
}
```

## 变量插入

### 选择器

```less
// 变量声明
@my-selector: banner;
// 变量使用
.@{my-selector} {
	font-weight: bold;
	line-height: 40px;
	margin     : 0 auto;
}
```

编译为：

```css
.banner {
	font-weight: bold;
	line-height: 40px;
	margin     : 0 auto;
}
```

### 链接

```less
// 变量声明
@images: "../img";
// 变量使用
body {
	color     : #444;
	background: url("@{images}/white-sand.png");
}
```

### 文件引用

version：1.4.0

```less
// 变量声明
@themes: "../src/themes";
// 变量使用
@import "@{themes}/tidal-wave.less";
```

### 属性

version：1.6.0

```less
@property: color;
.widget {
	@{property}           : #0ee;
	background-@{property}: #999;
}
```

编译为：

```css
.widget {
	color           : #0ee;
	background-color: #999;
}
```

### 变量名

甚至可使用变量名命名变量：

```less
@fnord: "I am fnord.";
@var: "fnord";
section{
	content: @@var;
}
```

编译为：

```css
section{
	content: "I am fnord.";
}
```

## 懒加载（Lazy Load）

变量可先使用，再声明。

```less
.lazy-eval-scope{
	width: @var;
}
@var: @a;
@a: 9%;
```

和

```less
.lazy-eval-scope{
	width: @var;
	@a: 9%;
}
@var: @a;
@a: 100%;
```

都编译为：

```css
.lazy-eval-scope{
	width: 9%;
}
```

如果变量多次定义，以最后一次声明为准。使用时由作用域向上查找。比如：

```less
@var: 0;
.class {
	@var: 1;
	.brass {
		@var : 2;
		three: @var;
		@var : 3;
	}
	one : @var;
}
```

编译结果为：

```css
.class{
	one: 1;
}
.class .brass{
	three: 3;
}
```

# 八. 继承

如下例：

```less
nav ul:extend(.inline){
	background: blue;
}
.inline{
	color: red;
}
```

编译为：

```css
nav ul{
	background: blue;
}
.inline,
nav ul{
	color: red;
}
```

编译结果中，继承属性在原声明中删除，出现在被继承规则相同位置。如上例，如果将`.inline`规则写在`nav ul`之前，编译结果将是：

```css
.inline,
nav ul {
  color: red;
}
nav ul {
  background: blue;
  color: yellow;
}
```

## 语法

下面两种写法等价：

```less
// 在选择器后声明
.a:extend(.b){}
```

```less
// 在规则中声明
.a{
	&:extend(b);
}
```

不过建议使用第一种，因为如果使用Atom插件atom-beauty，且选择`align assignments`，会导致语法错误。

如果使用关键字`all`，则可继承嵌套中的规则（默认只继承第一层级）：

```less
.inline {
	color: red;

	a {
		font-weight: bold;
	}
}
nav ul:extend(.inline all){
	background: blue;
	color     : yellow;
}
```

编译为：

```css
.inline,
nav ul {
	color: red;
}

.inline a,
nav ul a {
	font-weight: bold;
}

nav ul {
	background: blue;
	color     : yellow;
}
```

还可继承多个：

```less
.inline {
	color: red;

	a {
		font-weight: bold;
	}
}

.block {
	display: block;
}
nav ul:extend(.inline all, .block){
	background: blue;
	color     : yellow;
}
```

编译为：

```css
.inline,
nav ul {
	color: red;
}

.inline a,
nav ul a {
	font-weight: bold;
}

.block,
nav ul {
	display: block;
}

nav ul {
	background: blue;
	color     : yellow;
}
```

## 在选择器后声明

一个选择器后可跟多个继承语句，但位置必须在最后。

-   在选择器后：`pre:hover:extend(div pre)`
-   允许选择器和继承语句间有空格： `pre:hover :extend(div pre)`
-   允许多个继承：`pre:hover:extend(div pre):extend(.bucket tr)`
    等价于`pre:hover:extend(div pre, .buket tr)`
-   不允许出现在中间：`pre:hover:extend(div pre).nth-child`

如果有多个选择器，每个选择器都允许继承：

```less
.big-division,
.big-bag:extend(.bag),
.big-bucked:extend(.bucket){
	// ....
}
```

## 在规则中声明

在规则中声明使用`&:extend(selector)`语法。如：

```less
pre:hover,
.some-class{
	&:extend(div pre);
}
```

等价于：

```less
pre:hover:extend(div pre){}
.some-class:extend(div pre){}
```

## 继承被嵌套的选择器

处于嵌套中的选择器，同样也可被继承：

```less
.bucket{
	tr{
		color: blue;
	}
}
.some-class:extend(.bucket tr){}
```

编译为：

```css
.bucket tr,
.some-class{
	color: blue;
}
```

继承以编译后的CSS为基准，而不是原来的Less：

```less
.bucket{
	tr & {
		color: blue;
	}
}
.some-class:extend(tr .bucket){}
```

编译为

```css
tr .bucket,
.some-class{
	color: blue;
}
```

## 精确继承

继承的选择器必须在形式上精确一致。无论选择器首部是否有`*`号，`nth`表达式计算的结果是否一致，只要形式上不一致，都不能实现继承。唯一例外的是属性选择器，含义相同即可。下面两个例子都不能正常继承。

```less
.a.class,
.class.a,
.class > .a{
	color: blue;
}
.test:extend(.class){}
```

```less
*.class{
	color: blue;
}
.noStar:extend(.class){}
```

如果是伪类选择器，其顺序同样需保持一致：

```less
link:hover:visited{
	color: blue;
}
.selector:extend(link:visited:hover){} //不能正常继承。
```

### nth选择器

即使`1n+3`和`n+3`计算结果一样，但形式不一还是不能继承：

```less
:nth-child(1n+3){
	color: blue;
}
.child:extend(:nth-child(n+3)){} //不能正常继承
```

### 属性选择器中的引号

属性选择器中的引号形式可不精确匹配，下例可正常继承

```less
[title=identifier] {
	color: blue;
}

[title='identifier'] {
	color: blue;
}

[title="identifier"] {
	color: blue;
}
.noQuote:extend([title=identifier]){}
.singleQuote:extend([title='identifier']){}
.doubleQuote:extend([title="identifier"]){}
```

## 继承所有（“all”）

如果继承时声明关键字`all`，所有继承选择器出现的地方都会被继承：

```less
.test.c,
a.b.test {
	color: green;
}

.test {
	&:hover {
		color: green;
	}
}

.replacement:extend(.test all){}
```

编译为：

```css
.test.c,
.replacement.c,
a.b.test,
a.b.replacement{
	color: green;
}

.test:hover，
replacement:hover{
	color: green;
}
```

## “插值”选择器继承

如果被继承的选择器由“插值”生成，则继承被忽略：

```less
@var: .bucket;

@{var} {
	color: blue;
}

.some-class:extend(.bucket){}
```

```less
@var: .bucket;

@{var} {
	color: blue;
}

.some-class:extend(@{var}){}
```

上两例都不能正常继承。
不过下例可正常继承：

```less
.bucket {
	color: blue;
}
@{var}:extend(.bucket){}
@var: .selector;
```

编译为：

```css
.bucket,
.selector {
  color: blue;
}
```

## `@media`与继承

仅能在同一级`media`继承：

```less
@media print {
	.screenClass:extend(.selector){}

	.selector {
		color: black;
	}
}

.selector {
	//另一个作用域，不继承
	color: red;
}
@media screen {
	// 另一个@media，不继承
	.selector {
		color: blue;
	}
}
```

编译为：

```css
@media print {
  .selector,
  .screenClass {
    color: black;
  }
}
.selector {
  color: red;
}
@media screen {
  .selector {
    color: blue;
  }
}
```

也不能继承同一级中，嵌套在另外一个`@media`中的选择器：

```less
@media screen {
	.screenClass:extend(.selector){}
	@media (min-width: 1023px) {
		.selector {
			color: blue;
		}
	}
}
```

不能正常继承，编译为：

```css
@media screen and (min-width: 1023px) {
	.selector {
		color: blue;
	}
}
```

如果在`@media`外部继承其内部选择器，即使选择器嵌套在内，也会被继承：

```less
@media screen {
	.selector {
		color: blue;
	}
	@media (min-width: 1023px) {
		.selector {
			color: blue;
		}
	}
}
.topLevel:extend(.selector){}
```

编译为：

```css
@media screen {
  .selector,
  .topLevel {
    color: blue;
  }
}
@media screen and (min-width: 1023px) {
  .selector,
  .topLevel {
    color: blue;
  }
}
```

## 重复检测

目前还不支持重复检测功能：

```less
.alert-info,
.widget {
	color: blue;
}
.alert:extend(.alert-info, .widget){}
```

编译为：

```css
.alert-info,
.widget,
.alert,
.alert {
  color: blue;
}
```

## 继承使用场景

### 经典案例

减少类名。如下例：

```less
.animal{
	background-color: black;
	color: white;
}
```

如果需要为特定动物，如bear添加样式，只更改背景颜色。有两种方法可选：

1.更改HTML结构

    ```html
    <a href="#" class="animal bear">Bear</a>
    ```
    
    ```less
    .animal{
    	background-color: black;
    	color: white;
    }
    .bear{
    	background-color: brown;
    }
    ```

2.不更改HTML结构，而是在样式中继承

    ```html
    	<a href="#" class="bear">Bear</a>
    ```
    
    ```less
    .animal{
    	background-color: black;
    	color: white;
    }
    .bear:extend(.animal){
    	background-color: brown;
    }
    ```

### 减小CSS文件大小

混合器（mixin）会复制所有规则，导致不必要的声明重复，使用继承可有效解决这一问题。

例（使用混合器）:

```less
.my-inline-block {
	display  : inline-block;
	font-size: 0;
}

.thing1 {
	.my-inline-block;
}

.thing2 {
	.my-inline-block;
}
```

编译为：

```css
.my-inline-block {
  display: inline-block;
  font-size: 0;
}
.thing1 {
  display: inline-block;
  font-size: 0;
}
.thing2 {
  display: inline-block;
  font-size: 0;
}
```

使用继承：

```less
.my-inline-block {
	display  : inline-block;
	font-size: 0;
}
.thing1:extend(.my-inline-block){}
.thing2:extend(.my-inline-block){}
```

编译为：

```css
.my-inline-block,
.thing1,
.thing2 {
  display: inline-block;
  font-size: 0;
}
```

### 高级版混合器（mixin）

混合器（mixin）只能用于简单的选择器。当mixin不能满足需求时，可用继承替代：

```less
li.list > a {
	color: blue;
}
button.list-style:extend(li.list > a){}
```



# 九. 混合器（mixin）

ID和class选择器，以及非绑定属性声明集都可作为混合器：

```less
#id,
.a {
	color: blue;
}
.mixin-class {
	.a();
}
.mixin-id {
	#id();
}
```

编译为：

```css
#id,
.a {
  color: blue;
}
.mixin-class {
  color: blue;
}
.mixin-id {
  color: blue;
}
```

使用混合器时，后面的小括号可省（非绑定属性声明集除外），下面两种写法等价：

```less
body{
	.a;
}
body{
	.a();
}
```

## 不输出混合器自身

如果需要使用混合器，但又不将其输出，可在声明时后面紧跟小括号：

```less
.my-mixin {
	color: black;
}
.my-other-mixin() {
	background: white;
}
.class {
	.my-mixin;
	.my-other-mixin;
}
```

编译为：

```css
.my-mixin {
  color: black;
}
.class {
  color: black;
  background: white;
}
```

## 混合器中嵌套选择器

混合器中不只是可含属性声明，同样可嵌套选择器：

```less
.my-hover-mixin() {
	&:hover {
		border: 1px solid blue;
		a {
			font-size: 20px;
		}
	}
}
button {
	.my-hover-mixin;
}
```

编译为：

```css
button:hover {
  border: 1px solid blue;
}
button:hover a {
  font-size: 20px;
}
```

## 命名空间（namespace）

某些情况下，只需使用混合其中嵌套的规则：

```less
#outer() {
	.inner {
		color: blue;
		.inner-most {
			background-color: yellow;
		}
	}
}
.c {
	#outer > .inner;
}
```

编译为：

```css
.c {
  color: blue;
}
.c .inner-most {
  background-color: yellow;
}
```

其中`>`和空格可选，下例等价：

```less
.c{
	#outer .inner;
}

.c{
	#outer.inner;
}
```

如需使用嵌套2层以上的选择器（如`.inner-most`），不能跳过其父选择器：

```less
.c{
	#outer > .inner > .inner-most;
}
```

或者：

```less
.c{
	#outer .inner .inner-most;
}
```

或者：

```less
.c{
	#outer.inner.inner-most;
}
```

都可。而下例不可：

```less
.c{
	#outer .inner-most;
}
```

## 带条件的命名空间（Guarded Namespaces）

## `!improtant`关键字

使用混合器时，如声明`!important`关键字，生成的所有属性都会带上`!important`关键字：

```less
.foo() {
	background-color: yellow;
	color           : black;
}
.unimportant {
	.foo();
}
.important {
	.foo() !important;
}
```

编译为：

```css
.unimportant {
  background-color: yellow;
  color: black;
}
.important {
  background-color: yellow !important;
  color: black !important;
}
```

# 十. 将混合器作为函数

混合器可带参数：

```less
.border-radius(@radius) {
	-webkit-border-radius: @radius;
	-moz-border-radius   : @radius;
	border-radius        : @radius;
}
#header {
	.border-radius(4px);
}
#bottom {
	.border-radius(10px);
}
```

编译为：

```css
#header {
	-webkit-border-radius: 4px;
	-moz-border-radius   : 4px;
	border-radius        : 4px;
}
#bottom {
	-webkit-border-radius: 10px;
	-moz-border-radius   : 10px;
	border-radius        : 10px;
}
```

所带参数可是默认参数：

```less
.border-radius(@radius:5px) {
	-webkit-border-radius: @radius;
	-moz-border-radius   : @radius;
	border-radius        : @radius;
}
#header {
	.border-radius();
}
```

不带参数的混合器，编译后消失：

```less
.wrap() {
	text-wrap  : wrap;
	white-space: -moz-pre-wrap;
	white-space: pre-wrap;
	word-wrap  : break-word;
}
.pre {
	.wrap();
}
```

编译为：

```css
.pre {
	text-wrap  : wrap;
	white-space: -moz-pre-wrap;
	white-space: pre-wrap;
	word-wrap  : break-word;
}
```

## 带多个参数的混合器

参数可用`,`或`;`隔开，建议使用分号。因为逗号有双重意义：隔开参数；隔开CSS的列表内容。

若使用逗号隔开，就不能使用逗号作为CSS的列表隔离器。此外，如果形参和实参中只要有一个分号，就会默认使用分号作为参数隔离器，而所有逗号都作为CSS列表隔离器：

-   2个参数，每个参数都为列表：`.name(1, 2, 3; something else)`
-   3个参数，每个参数都是一个数字：`.name(1, 2, 3)`
-   1个参数，该参数为CSS列表：`.name(1, 2, 3;)`
-   1个参数，且初始化默认值：`.name(@param1: yellow, blue;)`

多个混合器可同名，参数个数也可相同。编译时Less将尽可能多的使用这些混合器。比如调用`.mixin(green)`时，只要混合器有且只有一个_强制参数（无默认值）_ ，它们中声明的属性都会编译出来：

```less
.mixin(@color) {
	color-1: @color;
}
.mixin(@color, @width:20px) {
	color-2: @color;
	width  : @width;
}
.mixin(@color; @padding; @margin:2px) {
	color-3  : @color;
	padding-3: @padding;
	margin   : @margin;
}
.some .selector div {
	.mixin(#fff);
}
```

编译为：

```css
.some .selector div {
	color-1: #fff;
	color-2: #fff;
	width  : 20px;
}
```

## 默认参数

实参顺序不必与形参相同。不过，如果同时有默认参数和非默认参数，默认参数一般写在最后：

```less
.mixin(@color; @margin:10px; @padding:10px) {
	color  : @color;
	margin : @margin;
	padding: @padding;
}
.class1 {
	.mixin(yellow; @padding: 100px; @color: black);
}
.class2 {
	.mixin(yellow; @padding: 100px; @margin: 100px);
}
.class3 {
	.mixin(yellow; 1000px; @padding: 100px);
}
```

编译为：

```css
.class1 {
	color  : black;
	margin : 10px;
	padding: 100px;
}
.class2 {
	color  : yellow;
	margin : 100px;
	padding: 100px;
}
.class3 {
	color  : yellow;
	margin : 1000px;
	padding: 100px;
}
```

## `@arguments`变量

`@arguments`变量表示混合器的所有形参（与js类似）：

```less
.box-shadow(@x:0; @y: 0; @blur: 1px; @color: #000) {
	-webkit-box-shadow: @arguments;
	-moz-box-shadow   : @arguments;
	box-shadow        : @arguments;
}
.big-block {
	.box-shadow(@x: 2px; @y: 3px);
}
```

编译为：

```css
.big-block {
	-webkit-box-shadow: 2px 3px 1px #000;
	-moz-box-shadow   : 2px 3px 1px #000;
	box-shadow        : 2px 3px 1px #000;
}
```

## `@rest`变量

如果混合器参数在不同调用中个数可能发生变化，声明时可使用`...`关键字表示：

```less
.mixin(...){}//0-n个实参
.mixin(){}//0个实参
.mixin(@a: 1){}//0-1个实参
.mixin(@a: 1; @rest...){}//0-n个实参
.mixin(@a; @rest...)//1-n个实参
```

```less
.mixin(@a; @rest...){
	// @rest表示参数@a后的所有参数
	// @arguments表示所有参数
}
```

```less
.box-shadow(@x; @rest...) {
	-webkit-box-shadow: @x @rest;
	-moz-box-shadow   : @x @rest;
	box-shadow        : @x @rest;
}
.big-block {
	.box-shadow(10px; 2px; 1px; #fff);
}
```

编译为：

```css
.big-block {
	-webkit-box-shadow: 10px 2px 1px #fff;
	-moz-box-shadow   : 10px 2px 1px #fff;
	box-shadow        : 10px 2px 1px #fff;
}
```

## 模式匹配

如需要混合器根据环境的不同改变其行为，可利用模式匹配。即根据传入实参的不同，改变行为：

```less
.mixin(dark; @color) {
	color: darken(@color, 10%);
}
.mixin(light; @color) {
	color: lighten(@color, 10%);
}
.mixin(@_, @color) {
	display: block;
}
@switch: light;
.class {
	.mixin(@switch; #999);
}
```

编译为：

```css
.class {
	color  : #808080;
	display: block;
}
```

-   第一个mixin没有匹配：第一个形参为`dark`
-   第二个mixin匹配：第一个形参为`light`
-   第三个mixin匹配：第一个形参可为任意值

**形参如果是变量，与任意值匹配；形参如果不是变量，需与该形参完全一致。**  

## 混合器的“返回值”

调用混合器的作用域中，被调用混合器中声明的变量和混合器可见：

```less
.mixin() {
	@width: 100px;
	.inner-mixin() {
		@height: 10px;
		height : @height;
	}
}
.caller {
	.mixin();
	width : @width;
	.inner-mixin();
	height: @height;
}
```

编译为：

```css
.caller {
	width : 100px;
	height: 10px;
}
```

唯一例外的是，如果调用作用域本身声明的变量名相同，不会被重载：

```less
.mixin() {
	@width : 100px;
	@height: 10px;
}
.caller {
	.mixin();
	@height: 1000px;
	width  : @width;
	height : @height;
}
```

编译为：

```css
.caller {
	width : 100px;
	height: 1000px;
}
```

不过只限于调用环境的本地作用域，来自其父作用域的变量会被重载：

```less
.mixin() {
	@width : 100px;
	@height: 10px;
}
.caller-parent {
	@height: 1000px;
	.caller {
		.mixin();
		width : @width;
		height: @height;
	}
}
```

编译为：

```css
.caller-parent .caller {
	width : 100px;
	height: 10px;
}
```

由上可见，混合器中定义的变量具有返回值的功能，使得混合器与真正的函数相差无几：

```less
.average(@x, @y){
	@average: ((@x + @y) / 2);
}

div{
	.average(16px, 50px);
	padding: @average;
}
```

编译为：

```css
div {
	padding: 33px;
}
```

混合器中定义的混合器，也可作为“返回值”：

```less
.unlock(@value) {
	.doSomething() {
		padding: @value;
	}
}
div {
	.unlock(10px); //将混合器doSomething作为返回值
	.doSomething(); //调用doSomething混合器
}
```

编译为：

```css
div {
	padding: 10px;
}
```

## 非绑定属性声明集（Detached Ruleset）

非绑定属性声明集：具有所有Less声明特性，只是不包含选择器。可如混合器一样调用，只是调用时后面的小括号不能省略（`@detached-ruleset();`）：

```less
@detached-ruleset: {
	background-color: yellow;
};
.top {
	@detached-ruleset(); //小括号()不能省略！！！
}
```

编译为：

```css
.top {
	background-color: yellow;
}
```

同时还可作为混合器参数，在媒体查询和浏览器兼容方面实用性很强：

```less
.desktop-and-old-ie(@rules) {
	@media screen and (min-width: 1200px) {
		 @rules();
	}
	html.lt-ie9 & {
		@rules();
	}
}
header {
	background-color: yellow;
	.desktop-and-old-ie({ background-color: blue; });
}
```

编译为：

```css
header {
	background-color: yellow;
}
@media screen and (min-width: 1200px) {
	header {
		background-color: blue;
	}
}
html.lt-ie9 header {
	background-color: blue;
}
```

同混合器一样，也可将混合器作为返回值：

```less
@detached-ruleset: {
	.mixin() {
		color: blue;
	}
};
.caller {
	@detached-ruleset();
	.mixin();
}
```

编译为：

```css
.caller {
	color: blue;
}
```

然而，不能将变量作为返回值：

```less
@detached-ruleset: {
	@color: blue;
};
.caller {
	@detached-ruleset();
	color: @color; //报错
}
```

### 作用域

#### 对自身声明环境，以及调用环境的变量和混合器都可见

对自身定义环境变量和混合器可见，这点显而易见，来看看后者：

```less
@detached-ruleset: {
	caller-variable: @caller-variable; //变量未定义
	.caller-mixin(); //混合器未定义
};
selector {
	// 调用属性声明集
	@detached-ruleset();
	// 在调用环境中声明变量和混合器
	@caller-variable: value;
	.caller-mixin() {
		mixin: definition;
	}
}
```

编译为：

```css
selector {
	caller-variable: value;
	mixin          : definition;
}
```

不过，如果自身定义环境与调用环境的变量或混合器重名，自身定义环境的变量和混合器优先：

```less
@variable: global;
@detached-ruleset: {
	// 这里就可见全局环境，所以使用全局环境中的@variable变量
	// 如果这里也定义了变量@variable，将使用此处的定义。
	// @variable: local-definition;
	variable: @variable;
};
selector {
	@detached-ruleset();
	@variable: caller;
}
```

编译为：

```css
selector {
	variable: global;
}
```

#### 复制不会改变非绑定属性声明集的作用域（没理解）

```less
@detached-1: {
	scope-detached: @two;
};
.one {
	@one: visible-one;
	.two {
		@detached-2: @detached-1; //复制/重命名非绑定属性声明集
		@two       : visible-two;
	}
}
.use-place {
	//对@detached-1和@detached-2，仅解锁了@two， 都没解锁@one
	.one > .two();
	@detached-1();
}
```

编译为：

```css
.use-place {
	scope-detached: visible-two;
}
```

如果源码首行为：

```less
@detached-1: {
	scope-detached: @one;
};
```

则报错。

#### 解锁会改变非绑定属性声明集的作用域

```less
#space {
	.importer-1 {
		@detached: {
			scope-detached: @variable
		}; //定义非绑定属性声明集
	}
}
.importer-2() {
	@variable: value; //被解锁后的非绑定属性声明集可见此变量
	#space > .importer-1(); //解锁非绑定属性声明集
	// @detached();
}
.use-place {
	.importer-2(); //第二次解锁
	// @variable: value2;
	@detached();
}
```

编译为：

```css
.use-place {
  scope-detached: value;
}
```



# 十一. 文件引用

CSS中，`@import`声明需位于所有规则声明前面。而Less对此声明位置无要求：

```less
.foo{
	background-color: #900;
}
@import "this-is-valid.less";
```

## 文件后缀

据文件后缀名不同，`@import`探测器处理不一：

-   如果后缀为`.css`，仅将此声明保留在编译后的文件中。
-   如果为其他后缀名，默认处理为Less文件。
-   如果没有后缀名，也会默认处理为Less文件。

例如：

```less
@import "foo"; //引用foo.less
@import "foo.less"; //引用foo.less
@import "foo.php"; //作为Less文件引用
@import "foo.css";//仅将此声明保留在编译后的文件中
```

## 引用选择

**以下选项可重载上述行为。**
语法：`@import (关键字1, 关键字2) "文件名"`

-   `reference`：仅将Less文件作为引用，其中的内容不输出到编译文件中
-   `inline`：仅将引用声明编译到结果中。
-   `less`：无论文件后缀名为何，都处理为Less文件。
-   `css`：无论文件后缀名为何，都处理为CSS文件。
-   `once`：只引用一次（默认行为）。
-   `multiple`：`@import`声明一次，引用一次。
-   `optional`：如果未查询到指定文件，依然编译。

### reference

被引用文件内容不编译，只有两个例外：

-   `extend`：继承生成的代码出现在`@import`声明的位置。
-   `mixin`：混合器生成的代码出现在使用混合器的位置。

### inline

某些场景下，Less也不能完全兼容CSS。比如一些位置不支持注释，且不支持CSS hack。因此，在编译后的文件引用声明，就可使用`inline`关键字。

### less

无论文件后缀为何，都做Less文件引用处理：

```less
@@import (less) "foo.css";
```

### css

无论文件后缀为何，都做CSS文件处理。这就意味着，仅将此项声明编译到结果中，相当于`inline`关键字:

```less
@import (css) "foo.less";
```

编译为：

```css
@import "foo.less";
```

### once

Less的默认行为，多次引用同一文件，只有第一次有效：

```less
@import (once) "foo.less";
@import (once) "foo.less"; //此声明被忽略
```

### multiple

与`once`刚好相反，每次引用具有同样效果：

```less
// foo.less
.a{
	color: green;
}

// main.less
@import (multiple) "foo.less";
@import (multiple) "foo.less";
```

编译为：

```css
.a{
	color: gree;
}
.a{
	color: gree;
}
```

### optional

默认情况下，如果不能查找到被引用的文件将报错，编译停止。使用`optional`关键字后，不报错，编译继续。

# 十二. 带条件的混合器

具有`if/else`条件语句功能，不过使用`@media`的形式。主要使用关键字`when`。
如下例：

```less
.mixin(@a) when (lightness(@a) > = 50) {
	background-color: black;
}
.mixin(@a) when (lightness(@a)< 50) {
	background-color: white;
}
.mixin(@a) {
	color: @a;
}
.class1 {
	.mixin(#ddd);
}
.class2 {
	.mixin(#111);
}
```

编译为：

```css
.class1 {
	background-color: black;
	color           : #ddd;
}
.class2 {
	background-color: white;
	color           : #111;
}
```

## 比较操作符

比较操作符有`>`、`>=`、`=`、`=<`、`<`。此外，关键字`true`是唯一真值。下面两例等价：

```less
.truth(@a) when (@a) {...}
.truth(@a) when (@a = true) {...}
```

所有除`true`以外的值都为假：

```less
.class{
	.truth(40); //40为假，所以不与上面的任何一个匹配。
}
```

参数不仅可与参数比较，也可同其他值比较：

```less
@media: mobile;

.mixin(@a) when (@media = mobile){...}
.mixin(@a) when (@media = desktop){...}

.mixin(@a; @b) when (@a > @b) {width: @a}
.mixin(@a; @b) when (@a < @b) {width: @b}
```

## 逻辑操作符

### 逻辑与：`and`

```less
.mixin(@a) when (isnumber(@a)) and (@a > 10) {
	width: @a;
}
```

### 逻辑或：`or`

使用逗号将语句隔开，表示逻辑非：

```less
.mixin(@a) when (@a > 10) or (@a < -10){...}
```

### 逻辑非：`not`

```less
.mixin(@a) when not(@a < -10) {
	width: @a;
}
```

## 类型检测

使用`is*`函数检测数据类型：

```less
.mixin(@a; @b:0) when(isnumber(@b)) {
	width : @a;
	height: @b;
}
```

基本检测函数：

-   `iscolor`
-   `isnumber`
-   `isstring`
-   `iskeyword`
-   `isurl`

还可检测数值所带单位：

-   `ispixel`
-   `ispercentage`
-   `isem`
-   `isunit`

## `default()`函数

```less
.mixin(@a; @b:0) when(isnumber(@b)) {
	width : @a;
	height: @b;
}
.mixin(@a; @b) when (default()) {
	color: yellow;
}
相当于编程语言`switch`语句中的`default`。即其他混合器都不能匹配时，就使用此混合器。
```

## 带条件的CSS选择器

CSS选择器同样可以限制：

```less
@my-option: true;
button when (@my-option = true) {
	color: white;
}
```

编译为：

```css
button {
  color: white;
}
```

也可用来限制多个选择器：

```less
@my-option: true;
& when (@my-option = true) {
	button {
		color: white;
	}
	a {
		color: blue;
	}
}
```



# 十三. 循环

Less混合器可递归调用。再结合限制条件和模式匹配，可实现不同的循环结构：

```less
.loop(@counter) when (@counter > 0) {
	.loop(@counter - 1);
	width: (10px * @counter);
}
div {
	.loop(5);
}
```

编译为：

```css
div {
  width: 10px;
  width: 20px;
  width: 30px;
  width: 40px;
  width: 50px;
}
```

再比如，生成栅格系统：

```less
.generate-columns(@n, @i:1) when (@i <= @n) {
	.column-@{i} {
		width: @i / @n * 100%;
	}
	.generate-columns(@n, @i+1);
}
.generate-columns(4);
```

编译为：

```css
.column-1 {
	width: 25%;
}
.column-2 {
	width: 50%;
}
.column-3 {
	width: 75%;
}
.column-4 {
	width: 100%;
}
```

# 十四. 合并

将属于同一属性的值合并在一起，比如background和transform。

## 使用逗号链接

属性名后添加符号`+`：

```less
.mixin() {
	box-shadow+: inset 0 0 10px #555;
}
.myclass {
	.mixin();
	box-shadow+: inset 10px 10px 10px #ccc;
}
```

编译为：

```css
.myclass {
  box-shadow: inset 0 0 10px #555, inset 10px 10px 10px #ccc;
}
```

## 使用空格合并

在属性名后添加符号`+_`：

```less
.background-img() {
	background+_: url("test.png");
}
.background {
	background+_: #ccc;
	.background-img();
}
```

编译为：

```css
.background {
  background: #ccc url("test.png");
}
```



# 十五. 父选择器

嵌套规则中，子选择器需引用父选择器，使用`&`操作符：

```less
a {
	color: blue;
	&:hover {
		color: green;
	}
}
```

编译为：

```css
a {
  color: blue;
}
a:hover {
  color: green;
}
```

也可如插值法一样改变选择器：

```less
.button {
	&-ok {
		background-image: url("ok.png");
	}
	&-cancel {
		background-image: url("cancel.png");
	}
	&-custom {
		background-image: url("custom.png");
	}
}
```

编译为：

```css
.button-ok {
  background-image: url("ok.png");
}
.button-cancel {
  background-image: url("cancel.png");
}
.button-custom {
  background-image: url("custom.png");
}
```

## 多个`&`

一个选择器内可多次引用其父选择器：

```less
.link {
	&+& {
		color: yellow;
	}
	& & {
		color: green;
	}
	&& {
		color: blue;
	}
	&,
	&ish {
		color: cyan;
	}
}
```

编译为：

```css
.link + .link {
  color: yellow;
}
.link .link {
  color: green;
}
.link.link {
  color: blue;
}
.link,
.linkish {
  color: cyan;
}
```

**注意：** `&`代表其所有父选择器（不仅是最近的祖先选择器）：

```less
.grand {
	.parent {
		&+& {
			color: yellow;
		}
		& & {
			color: green;
		}
		&& {
			color: blue;
		}
		&,
		&ish {
			color: cyan;
		}
	}
}
```

编译为：

```css
.grand .parent + .grand .parent {
  color: yellow;
}
.grand .parent .grand .parent {
  color: green;
}
.grand .parent.grand .parent {
  color: blue;
}
.grand .parent,
.grand .parentish {
  color: cyan;
}
```

## 改变选择器顺序

需将选择器置于其父选择器前面时，可将`&`置于当前选择器后面：

```less
.header {
	.menu {
		border-radius: 5px;
		.no-borderradius & {
			background-image: url("images/button-background.pgn");
		}
	}
}
```

编译为：

```css
.header .menu {
  border-radius: 5px;
}
.no-borderradius .header .menu {
  background-image: url("images/button-background.pgn");
}
```

## 最大限度结合

如果其父选择器为逗号`,`隔开的多个选择器，将最大限度结合：

```less
a,
li,
p,
ul {
	border-top: 2px dotted #369;
	& + & {
		border-top: none;
	}
}
```

编译为：

```css
a,
li,
p,
ul {
	border-top: 2px dotted #369;
}
a + a,
a + li,
a + p,
a + ul,
li + a,
li + li,
li + p,
li + ul,
p + a,
p + li,
p + p,
p + ul,
ul + a,
ul + li,
ul + p,
ul + ul {
	border-top: none;
}
```

# 十六. 函数

## (一) 字符串操作函数

## `escape`

对字符串进行URL-encoding.

-   不被转码的字符有：`,`、 `/`、 `?`、 `@`、 `&`、 `+`、 `'`、 `~`、 `!` 和`$`。
-   会被转码的字符有（只含大多数）：`空格`、 `#`、 `^`、 `(`、 `)`、 `{`、 `}`、 `|`、 `:`、 `>`、 `<`、 `;`、 `]`、 `[`和`=`。

例：

```less
html {
	value: escape(  'a=1');
}
```

编译为：

```css
html {
  value: a%3D1;
}
```

**注意：** 如果传入参数为非字符串，`rgb*`颜色（`rgb()`和`rgba()`等）返回`undefined`，而其他值只是返回其本身。不过此实现并不稳定，不要过分依赖。

## `e`

将字符串改变为没有引号的形式，其内容完全不变。

例：

```less
html {
	filter: e( "ms:alwaysHasItsOwnSyntax.For.Stuff()");
}
```

编译为：

```css
html {
  filter: ms:alwaysHasItsOwnSyntax.For.Stuff();
}
```

## `%`

语法： `%(string, arguments);`

参数：

-   `string`：含占位符的字符串。
-   `arguments`：填充占位符的值。

占位符：`s`、`S`、`d`、`D`、`a`、`A`。

-   以上占位符可代表任意值。
-   如需转义特殊字符，使用大写。比如“空格”转义为`%20`。
-   `d`、`D`、`a`、`A`与`s`、`S`的区别在于，如果与字符串结合使用，前者在结果中保留字符串引号，而后者会去除引号。

例：

```less
div {
	format-a-d      : %("repetitions: %a file: %d", 1 + 2, "directory/file.less");
	format-a-d-upper: %('repetitions: %A file: %D', 1 + 2, "directory/file.less");
	format-s        : %("repetitions: %s file: %s", 1 + 2, "directory/file.less");
	format-s-upper  : %('repetitions: %S file: %S', 1 + 2, "directory/file.less");
}
```

编译为：

```css
div {
	format-a-d      : "repetitions: 3 file: "directory/file.less"";
	format-a-d-upper: "repetitions: 3 file: %22directory%2Ffile.less%22";
	format-s        : "repetitions: 3 file: directory/file.less";
	format-s-upper  : "repetitions: 3 file: directory%2Ffile.less";
}
```

## `replace`

语法：`replace(string, pattern, replacement, flags)`

参数：

-   `string`：原字符串
-   `pattern`：字符串或正则表达式
-   `replacement`：替换内容
-   `flags`：（可选）正则表达式flag

例：

```less
div {
	value: replace( "Hello, Mars?", "Mars\?", "Earth!");
	value: replace( "One + one = 4", "one", "2", "gi");
	value: replace('This is a string.', "(string)\.$", "new $1.");
	value: replace(~ "bar-1", '1', '2');
}
```

编译为：

```css
div {
	value: "Hello, Earth!";
	value: "2 + 2 = 4";
	value: "This is a new string.";
	value: bar-2;
}
```



## (二) 列表操作函数

**列表：** 由逗号或空格隔开的一串值。

## `length`

例：

```less
@list: "banana", "tomato", "potato", "peach";
div{
	n: length(@list);
}
```

编译为：

```css
div{
	n: 4;
}
```

## `extract`

_与通常编程语言不同，起始索引为"1"_。
例：

```less
@list: apple, pear, coconut, orange;
div{
	value: extract(@list, 3);
}
```

编译为：

```css
div{
	value: coconut;
}
```



## (三) 类型检测函数

## `isnumber`

例：

```less
isnumber(#ff0); // false
isnumber(blue); // false
isnumber("string"); // false
isnumber(1234); // true
isnumber(56px); // true
isnumber(7.8%); // true
isnumber(keyword); // false
isnumber(url(...)); // false
```

## `isstring`

例：

```less
isstring(#ff0); // false
isstring(blue); // false
isstring("string"); // true
isstring(1234); // false
isstring(56px); // false
isstring(7.8%); // false
isstring(keyword); // false
isstring(url(...)); // false
```

## `iscolor`

例：

```less
iscolor(#ff0); // true
iscolor(blue); // true
iscolor("string"); // false
iscolor(1234); // false
iscolor(56px); // false
iscolor(7.8%); // false
iscolor(keyword); // false
iscolor(url(...)); // false
```

## `iskeyword`

例：

```less
iskeyword(#ff0); // false
iskeyword(blue); // false
iskeyword("string"); // false
iskeyword(1234); // false
iskeyword(56px); // false
iskeyword(7.8%); // false
iskeyword(keyword); // true
iskeyword(url(...)); // false
```

## `isurl`

例：

```less
isurl(#ff0); // false
isurl(blue); // false
isurl("string"); // false
isurl(1234); // false
isurl(56px); // false
isurl(7.8%); // false
isurl(keyword); // false
isurl(url(...)); // true
```

## `ispixel`

例：

```less
ispixel(#ff0); // false
ispixel(blue); // false
ispixel("string"); // false
ispixel(1234); // false
ispixel(56px); // true
ispixel(7.8%); // false
ispixel(keyword); // false
ispixel(url(...)); // false
```

## `isem`

例：

```less
isem(#ff0); // false
isem(blue); // false
isem("string"); // false
isem(1234); // false
isem(56px); // false
isem(78em); // true
isem(keyword); // false
isem(url(...)); // false
```

## `ispercentage`

例：

```less
ispercentage(#ff0); // false
ispercentage(blue); // false
ispercentage("string"); // false
ispercentage(1234); // false
ispercentage(56px); // false
ispercentage(7.8%); // true
ispercentage(keyword); // false
ispercentage(url(...)); // false
```

## `isruleset`

例：

```less
@rules: {
	color:yellow;
}
isruleset(@rules); //  true
isruleset(#ff0); // false
isruleset(blue); // false
isruleset("string"); // false
isruleset(1234); // false
isruleset(56px); // false
isruleset(7.8%); // false
isruleset(keyword); // false
isruleset(url(...)); // false
```

## `isunit`

例：

```less
isunit(11px, px);  // true
isunit(2.2%, px);  // false
isunit(33px, rem); // false
isunit(4rem, rem); // true
isunit(56px, "%"); // false
isunit(7.8%, '%'); // true
isunit(1234, em);  // false
isunit(#ff0, pt);  // false
isunit("mm", mm);  // false
```



## (四) 数学计算函数

## ceil

参数： 浮点型

返回值： 整数

例：`ceil(2.4)`

结果：`3`

## floor

参数： 浮点型

返回值： 整数

例：`floor(2.6)`

结果：`2`

## percentage

参数： 浮点型

返回值： 数值（百分数）

例：`percentage(0.5)`

结果：`50%`

## round

参数：

-   `number`：浮点型
-   `decimalPlace`：从第几位小数开始舍入（默认为0）

返回值：数值

例：`round(1.67)`

结果：`2`

例：`round(1.67,1)`

结果：`1.7`

## sqrt

参数： 浮点型

返回值： 数值

例：`sqrt(25cm)`

结果：`5cm`

例：`sqrt(18.6%)`

结果：`4.31277173%`

## abs

参数： 浮点型

返回值： 数值

例：`abs(25cm)`

结果：`25cm`

例：`abs(-18.6%)`

结果：`18.6%`

## pow

参数：

-   `base`：浮点型，基数
-   `exponent`：浮点型，次方数

返回值： 数值

例：

```less
html {
	value: pow(0cm, 0px);
	value: pow(25, -2);
	value: pow(25, 0.5);
	value: pow(-25, 0.5);
	value: pow(-25%, -0.5);
}
```

结果：

```css
html {
  value: 1cm;
  value: 0.0016;
  value: 5;
  value: NaN;
  value: NaN%;
}
```

## min

参数： `value1, value2, ... valuen`

返回值：参数中最小的数值

例：`min(3px, 42px, 1px, 16px);`

结果：`1px`

## max

参数： `value1, value2, ... valuen`

返回值：参数中最大的数值

例：`min(3px, 42px, 1px, 16px);`

结果：`16px`

## mode

参数：

-   基数：浮点型
-   模数：浮点型

返回值：数值

例：

```less
html {
  value: NaNcm;
  value: 5cm;
  value: -1%;
}
```

结果：

```css
html {
	value: NaNcm;
	value: 5cm;
	value: -1%;
}
```

## pi

参数： 无

返回值： `pi`

例：`pi()`

结果：`3.14159265`

## sin

## asin

## cos

## acos

## tan

## atan



## (五) 颜色定义函数

## rgb

参数：

-   `red`：0-255或0-100%
-   `green`：0-255或0-100%
-   `blue`：0-255或0-100%

返回值：`color`

例：`rgb(90, 129, 32)`

结果：`#5a8120`

## rgba

参数：

-   `red`：0-255或0-100%
-   `green`：0-255或0-100%
-   `blue`：0-255或0-100%
-   `alpha`：0-1或0-100%

返回值： `color`

例：`rgba(90, 129, 32, 0.5)`

结果：`rgba(90, 129, 32, 0.5)`

## argb

## hs1

## hsla

## hsv

## hsva

## (六)颜色通道函数

## (七) 颜色混合函数

## (八) 颜色操作函数

## lighten

参数：

-   `color`：颜色对象
-   `amount`： 0%-100%
-   `method`：可选。`relative` -> 相对于当前颜色。

返回值：`color`

例：`lighten(#ccc, 10%)`

结果：`#e6e6e6`

例：`lighten`(#ccc, 10%, relative)

结果：`#e0e0e0`

## darken

参数：

-   `color`：颜色对象
-   `amount`： 0%-100%
-   `method`：可选。`relative` -> 相对于当前颜色。

返回值：`color`

例：`darken(#ccc, 10%)`

结果：`#e3e3e3`

例：`darken(#ccc, 10%, relative)`

结果：`#e8e8e8`

## contrast

> 设置对比背景很有用。

参数：

-   `color`：颜色对象。作为对比基础。
-   `dark`：可选-指定黑色（默认为black）
-   `light`：可选-指定白色（默认为white）
-   `threshold`：可选-颜色转变程度（默认为43%）

返回值：`color`。白色或黑色，取决于与第一个参数的最大对比度。

例：

```less
html {
	color: contrast(#aaaaaa);
	color: contrast(#222222, #101010);
	color: contrast(#222222, #101010, #dddddd);
}
```

编译为：

```css
html {
  color: #000000;
  color: #ffffff;
  color: #dddddd;
}
```

## (九) 其他函数

## color

> 将代表颜色的字符串，转换为颜色

参数： 代表颜色的字符串

返回值： `color`

例：`color("#aaa")`

结果：#aaaaaa

## convert

> 在数值之间进行单位转换

如果单位不兼容，返回结果保持第一个参数原样。

参数：

-   `number`： 带单位的数值
-   `identifer`：单位

返回值： `number`

例：

```less
html {
	value: convert(9s, "ms");
	value: convert(14cm, mm);
	value: convert(8, mm); // 不兼容
}
```

结果：

```css
html {
  value: 9000ms;
  value: 140mm;
  value: 8;
}
```

## default

> 只适用于带条件的混合器。当所有同名混合器都不满足条件时，返回`true`。

## unit

参数：

-   `dimension`：带单位或不带单位的数值。
-   `unit`：（可选）希望转换成的单位，如果省略则将原本的单位删除。

返回值： `number`

例：unit(5, px)

结果：5px

例：unit(5px)

结果：5

## get-unit

> 返回数值的单位

参数： `number`

返回值： 如果数值带单位，返回其单位；如果不带单位，没有返回值。

例：get-unit(5px)

结果：px

例：get-unit(5)

结果：//nothing

## image-size

## image-width

## image-height

## svg-gradient